{"version":3,"file":"5d9fbf182731540ddea5.js","sources":["./src/nodes/elements/inputs/select/fabricVersions/v0.1.0/v0.6.0/ControlledSelect.tsx"],"sourcesContent":["import { forwardRef, useImperativeHandle, useState } from \"react\"\nimport icons from \"../../../../../../../libs/icons/v0.2.0/icons\"\nimport { useShallowEffect } from \"@mantine/hooks\"\nimport { sendOutput, sendSignal } from \"../../../../../../../libs/nodesFabric/v0.1.0/send/v0.4.0/send\"\nimport { Select } from \"@mantine/core\"\nimport converForSelectInputs from '../../../../../../../utils/converForSelectInputs/v0.2.0/converForSelectInputs'\nimport convertColor from \"../../../../../../../utils/convertColor/v0.2.0/convertColor\"\nimport getCompProps from \"../../../../../../../libs/nodesFabric/v0.1.0/getCompProps/v0.1.0/getCompProps\"\nimport { CompProps } from \"./types\"\n\nexport default forwardRef(function (props: CompProps, ref) {\n    const { getValue } = window.R.utils\n\n    const p = { ...getCompProps(props) } as CompProps\n    const { noodlNode, iconName, inputItems, labelField, defaultItem } = p\n\n    const Icon = iconName && icons(iconName)\n\n    const defaultValue = defaultItem?.value || defaultItem?.label || defaultItem?.id || null\n\n    const [data, setData] = useState<any[]>([])\n    useShallowEffect(() => {\n        if (!inputItems?.length) setData([])\n        if (inputItems && labelField && inputItems?.some((i: any) => getValue.v8(i, labelField)))\n            setData(inputItems.map(i => converForSelectInputs(i, labelField)))\n    }, [inputItems, labelField])\n\n    const [value, setValue] = useState<string | null>(null)\n    useShallowEffect(() => { if (defaultValue) setValue(defaultValue) }, [defaultValue])\n\n    // reset\n    useImperativeHandle(ref, () => ({\n        resetSelected() { setValue(null) }\n    }), [])\n\n    return (\n        <Select\n            nothingFound=\"Не найдено\"\n            getCreateLabel={(value) => `+ Создать \"${value}\"`}\n            onCreate={(value) => {\n                sendOutput(noodlNode, 'createValue', value)\n                sendSignal(noodlNode, 'createValueSubmited')\n                return undefined\n            }}\n            data={data}\n            value={value}\n            icon={Icon && <Icon size={p.iconSize} stroke={p.stroke} />}\n            error={p.inputError || false}\n            onChange={(v) => {\n                setValue(v)\n                if (!v) {\n                    sendOutput(noodlNode, 'selectedItem', null)\n                    setTimeout(() => sendSignal(noodlNode, 'reseted'))\n                } else {\n                    const selectedItem = inputItems?.find((i: any) => v && [i.value, i.id, i.label].includes(v))\n                    sendOutput(noodlNode, 'selectedItem', selectedItem)\n                    setTimeout(() => sendSignal(noodlNode, 'selected'))\n                }\n            }}\n            styles={() => ({\n                item: {\n                    '&[data-selected]': { '&, &:hover': { backgroundColor: convertColor(p.backgroundColor) }, },\n                    '&[data-hovered]': {},\n                },\n            })}\n            {...p}\n            {...p.customProps}\n        />\n    )\n})"],"names":["forwardRef","props","ref","getValue","window","R","utils","p","noodlNode","iconName","inputItems","labelField","defaultItem","Icon","defaultValue","value","label","id","useState","data","setData","useShallowEffect","length","some","i","v8","map","setValue","useImperativeHandle","resetSelected","Select","nothingFound","getCreateLabel","onCreate","sendOutput","sendSignal","icon","size","iconSize","stroke","error","inputError","onChange","v","selectedItem","find","includes","setTimeout","styles","item","backgroundColor","customProps"],"mappings":"+oDAUA,MAAe,KAAAA,UAAA,EAAW,SAAUC,CAAgB,CAAEC,CAAG,EACrD,IAAQC,EAAaC,OAAOC,CAAC,CAACC,KAAK,CAA3BH,QAAQ,CAEVI,EAAI,KAAK,cAAaN,IACpBO,EAA6DD,EAA7DC,SAAS,CAAEC,EAAkDF,EAAlDE,QAAQ,CAAEC,EAAwCH,EAAxCG,UAAU,CAAEC,EAA4BJ,EAA5BI,UAAU,CAAEC,EAAgBL,EAAhBK,WAAW,CAE1DC,EAAOJ,GAAY,cAAMA,GAEzBK,EAAe,AAAAF,CAAAA,MAAAA,EAAA,OAAAA,EAAaG,KAAK,AAAD,GAAKH,CAAAA,MAAAA,EAAA,OAAAA,EAAaI,KAAK,AAAD,GAAKJ,CAAAA,MAAAA,EAAA,OAAAA,EAAaK,EAAE,AAAD,GAAK,KAE5D,SAAAC,QAAA,EAAgB,EAAE,KAAnCC,EAAiB,KAAXC,EAAW,KACxB,KAAAC,gBAAA,EAAiB,WACT,CAACX,CAAAA,MAAAA,EAAA,OAAAA,EAAYY,MAAM,AAAD,GAAGF,EAAQ,EAAE,EAC/BV,GAAcC,GAAcD,CAAAA,MAAAA,EAAA,OAAAA,EAAYa,IAAI,CAAC,SAACC,CAAC,E,OAAUrB,EAASsB,EAAE,CAACD,EAAGb,E,KACxES,EAAQV,EAAWgB,GAAG,CAAC,SAAAF,CAAA,E,MAAK,cAAsBA,EAAGb,E,GAC7D,EAAG,CAACD,EAAYC,EAAW,EAE3B,IAA0B,SAAAO,QAAA,EAAwB,SAA3CH,EAAmB,KAAZY,EAAY,KAQ1B,MAPA,KAAAN,gBAAA,EAAiB,WAAYP,GAAca,EAASb,EAAc,EAAG,CAACA,EAAa,EAGnF,KAAAc,mBAAA,EAAoB1B,EAAK,W,MAAO,CAC5B2B,cAAA,WAAkBF,EAAS,KAAM,CACrC,C,EAAI,EAAE,EAGF,oBAAC,EAAAG,MAAM,IACHC,aAAa,aACbC,eAAgB,SAACjB,CAAK,E,MAAM,cAAmB,OAANA,EAAM,I,EAC/CkB,SAAU,SAAClB,CAAK,EACZ,KAAAmB,UAAA,EAAW1B,EAAW,cAAeO,GACrC,KAAAoB,UAAA,EAAW3B,EAAW,sBAE1B,EACAW,KAAMA,EACNJ,MAAOA,EACPqB,KAAMvB,GAAQ,oBAACA,EAAA,CAAKwB,KAAM9B,EAAE+B,QAAQ,CAAEC,OAAQhC,EAAEgC,MAAM,A,GACtDC,MAAOjC,EAAEkC,UAAU,EAAI,GACvBC,SAAU,SAACC,CAAC,EAER,GADAhB,EAASgB,GACJA,EAGE,CACH,IAAMC,EAAelC,MAAAA,EAAA,OAAAA,EAAYmC,IAAI,CAAC,SAACrB,CAAC,E,OAAUmB,GAAK,CAACnB,EAAET,KAAK,CAAES,EAAEP,EAAE,CAAEO,EAAER,KAAK,CAAC,CAAC8B,QAAQ,CAACH,E,GACzF,KAAAT,UAAA,EAAW1B,EAAW,eAAgBoC,GACtCG,WAAW,W,MAAM,KAAAZ,UAAA,EAAW3B,EAAW,W,EAC3C,KANI,KAAA0B,UAAA,EAAW1B,EAAW,eAAgB,MACtCuC,WAAW,W,MAAM,KAAAZ,UAAA,EAAW3B,EAAW,U,EAM/C,EACAwC,OAAQ,W,MAAO,CACXC,KAAM,CACF,mBAAoB,CAAE,aAAc,CAAEC,gBAAiB,cAAa3C,EAAE2C,eAAe,CAAE,CAAG,EAC1F,kBAAmB,CAAC,CACxB,CACJ,C,GACI3C,EACAA,EAAE4C,WAAW,EAG7B,E"}