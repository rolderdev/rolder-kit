{"version":3,"file":"105f9761d34740dfcf6e.js","sources":["./src/nodes/elements/inputs/select/fabricVersions/v0.1.0/v0.6.0/FormSelect.tsx"],"sourcesContent":["import { forwardRef, useImperativeHandle, useState } from \"react\"\nimport icons from \"../../../../../../../libs/icons/v0.2.0/icons\"\nimport { useShallowEffect } from \"@mantine/hooks\"\nimport { sendOutput, sendSignal } from \"../../../../../../../libs/nodesFabric/v0.1.0/send/v0.4.0/send\"\nimport { Select } from \"@mantine/core\"\nimport converForSelectInputs from '../../../../../../../utils/converForSelectInputs/v0.2.0/converForSelectInputs'\nimport convertColor from \"../../../../../../../utils/convertColor/v0.2.0/convertColor\"\nimport { useMolecule } from \"bunshi/react\"\nimport { FormHookMolecule } from \"../../../../../../molecules/form/fabricVersions/v0.1.0/v0.4.0/useForm\"\nimport { useAtomValue } from \"jotai\"\nimport { CompProps } from \"./types\"\nimport getCompProps from \"../../../../../../../libs/nodesFabric/v0.1.0/getCompProps/v0.1.0/getCompProps\"\n\nexport default forwardRef(function (props: CompProps, ref) {\n    const { getValue } = window.R.utils\n\n    const p = { ...getCompProps(props) } as CompProps\n    const { noodlNode, iconName, inputItems, labelField, formField } = p\n\n    const Icon = iconName && icons(iconName)\n\n    const [data, setData] = useState<any[]>([])\n    useShallowEffect(() => {\n        if (!inputItems?.length) setData([])\n        if (inputItems && labelField && inputItems?.some((i: any) => getValue.v8(i, labelField)))\n            setData(inputItems.map(i => converForSelectInputs(i, labelField)))\n    }, [inputItems, labelField])\n\n    const { formHookAtom } = useMolecule(FormHookMolecule)\n    const formHook = useAtomValue(formHookAtom)\n\n    useShallowEffect(() => {\n        if (inputItems) {\n            const value = formHook?.values?.[formField] \n            const selectedItem = inputItems.find((i: any) => value && [i.value, i.id, i.label].includes(value))\n            sendOutput(noodlNode, 'selectedItem', selectedItem || null)\n            sendSignal(noodlNode, 'selected')\n            if (!value) sendSignal(noodlNode, 'reseted')\n        }\n    }, [formHook?.values?.[formField]])\n\n    // reset\n    useImperativeHandle(ref, () => ({ resetSelected() { formHook?.setFieldValue(formField, null) } }), [])\n\n    return <Select\n        data={data}\n        getCreateLabel={(value) => `+ Создать \"${value}\"`}\n        onCreate={(value) => {\n            sendOutput(noodlNode, 'createValue', value)\n            sendSignal(noodlNode, 'createValueSubmited')\n        }}\n        icon={Icon && <Icon size={p.iconSize} stroke={p.stroke} />}\n        nothingFound=\"Не найдено\"\n        styles={() => ({\n            item: {\n                '&[data-selected]': { '&, &:hover': { backgroundColor: convertColor(p.backgroundColor) }, },\n                '&[data-hovered]': {},\n            },\n        })}\n        {...p}\n        {...p.customProps}\n        {...formHook.getInputProps(formField)}\n    />\n})"],"names":["forwardRef","props","ref","getValue","window","R","utils","p","noodlNode","iconName","inputItems","labelField","formField","Icon","useState","data","setData","useShallowEffect","length","some","i","v8","map","formHookAtom","useMolecule","FormHookMolecule","formHook","useAtomValue","value","values","selectedItem","find","id","label","includes","sendOutput","sendSignal","useImperativeHandle","resetSelected","setFieldValue","Select","getCreateLabel","onCreate","icon","size","iconSize","stroke","nothingFound","styles","item","backgroundColor","customProps","getInputProps"],"mappings":"g2BAaA,MAAe,KAAAA,UAAA,EAAW,SAAUC,CAAgB,CAAEC,CAAG,EACrD,I,IAyBI,EAzBIC,EAAaC,OAAOC,CAAC,CAACC,KAAK,CAA3BH,QAAQ,CAEVI,EAAI,KAAK,cAAaN,IACpBO,EAA2DD,EAA3DC,SAAS,CAAEC,EAAgDF,EAAhDE,QAAQ,CAAEC,EAAsCH,EAAtCG,UAAU,CAAEC,EAA0BJ,EAA1BI,UAAU,CAAEC,EAAcL,EAAdK,SAAS,CAExDC,EAAOJ,GAAY,cAAMA,GAE/B,IAAwB,G,EAAA,KAAAK,QAAA,EAAgB,EAAE,E,EAAA,E,m0BAAnCC,EAAiB,KAAXC,EAAW,KACxB,KAAAC,gBAAA,EAAiB,WACT,CAACP,CAAAA,MAAAA,EAAA,OAAAA,EAAYQ,MAAM,AAAD,GAAGF,EAAQ,EAAE,EAC/BN,GAAcC,GAAcD,CAAAA,MAAAA,EAAA,OAAAA,EAAYS,IAAI,CAAC,SAACC,CAAC,E,OAAUjB,EAASkB,EAAE,CAACD,EAAGT,E,KACxEK,EAAQN,EAAWY,GAAG,CAAC,SAAAF,CAAA,E,MAAK,cAAsBA,EAAGT,E,GAC7D,EAAG,CAACD,EAAYC,EAAW,EAE3B,IAAQY,EAAiB,KAAAC,WAAA,EAAY,EAAAC,gBAAgB,EAA7CF,YAAY,CACdG,EAAW,KAAAC,YAAA,EAAaJ,GAe9B,MAbA,KAAAN,gBAAA,EAAiB,WACb,GAAIP,EAAY,CACZ,IAAc,EAARkB,EAAQF,MAAAA,EAAA,OAAgB,OAAhB,GAAAA,EAAUG,MAAM,AAAD,GAAf,mBAAkB,CAACjB,EAAU,CACrCkB,EAAepB,EAAWqB,IAAI,CAAC,SAACX,CAAC,E,OAAUQ,GAAS,CAACR,EAAEQ,KAAK,CAAER,EAAEY,EAAE,CAAEZ,EAAEa,KAAK,CAAC,CAACC,QAAQ,CAACN,E,GAC5F,KAAAO,UAAA,EAAW3B,EAAW,eAAgBsB,GAAgB,MACtD,KAAAM,UAAA,EAAW5B,EAAW,YAClB,CAACoB,GAAO,KAAAQ,UAAA,EAAW5B,EAAW,UACtC,CACJ,EAAG,CAACkB,MAAAA,EAAA,OAAgB,OAAhB,GAAAA,EAAUG,MAAM,AAAD,GAAf,mBAAkB,CAACjB,EAAU,CAAC,EAGlC,KAAAyB,mBAAA,EAAoBnC,EAAK,W,MAAO,CAAEoC,cAAA,WAAkBZ,MAAAA,GAAAA,EAAUa,aAAa,CAAC3B,EAAW,KAAM,CAAE,C,EAAI,EAAE,EAE9F,oBAAC,EAAA4B,MAAM,IACVzB,KAAMA,EACN0B,eAAgB,SAACb,CAAK,E,MAAM,cAAmB,OAANA,EAAM,I,EAC/Cc,SAAU,SAACd,CAAK,EACZ,KAAAO,UAAA,EAAW3B,EAAW,cAAeoB,GACrC,KAAAQ,UAAA,EAAW5B,EAAW,sBAC1B,EACAmC,KAAM9B,GAAQ,oBAACA,EAAA,CAAK+B,KAAMrC,EAAEsC,QAAQ,CAAEC,OAAQvC,EAAEuC,MAAM,A,GACtDC,aAAa,aACbC,OAAQ,W,MAAO,CACXC,KAAM,CACF,mBAAoB,CAAE,aAAc,CAAEC,gBAAiB,cAAa3C,EAAE2C,eAAe,CAAE,CAAG,EAC1F,kBAAmB,CAAC,CACxB,CACJ,C,GACI3C,EACAA,EAAE4C,WAAW,CACbzB,EAAS0B,aAAa,CAACxC,IAEnC,E"}