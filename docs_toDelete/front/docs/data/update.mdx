# update

Обновляет данные нескольких классов по схеме на сервере Kuzzle.

## Возможности

* Умеет обновлять данные разных классов одновременно.
* Тихое обновление - UseData не будет обновлять данные.
* Оптимистичные обновления - данные попадают в UseData до записи в БД.
* Запись истории изменений.
* Может возвращать ошибки с сервера.

## Ограничения

* 1000 документов для одного класса БД.

## Порты

### Вход

| Название Noodl | Системное название | Тип данных | Требуется | Зависимость | Комментарий |
| --- | --- | --- | --- | --- | --- |
| Update | update | signal | - | - | Обновить данные на сервере |
| Scheme | scheme | array | При запуске сигнала update | - | Схема |
| Optimistic | optimistic | boolean | - | - | Оптимистичное обновлени |

### Выход

| Название Noodl | Системное название | Тип данных | Зависимость | Комментарий |
| --- | --- | --- | --- | --- |
| Updating | updating | boolean | - | Статус обновления |
| Updated | updated | signal | - | Сигнал завершения обновления |
| Optimistic updated | optimisticUpdated | signal | optimistic | Сигнал завершения оптимистичного обновления |
| Data | data | object | - | Результаты |

## Инструкция

### Схема

| Ключ | Тип данных | Дефолтное значение | Комментарий |
| --- | --- | --- | --- |
| dbClass | string | - | Как в Kuzzle, но без версии. Обязательный параметр |
| history | boolean | false | Добавить объекты в историю перед их изменениями |
| items | array | - | Массив обновляемых объектов. В обновляемых данных должен быть id. Система не будет удалять те данные, которые не указаны, т.е. достаточно указать только нужные изменения |

### Примеры

#### Обновление одного документа

```js
[
    {
        dbClass: 'house',
        items: [{
            id: selectedHouse.id,            
            content: {
                address: 'New adress',
                name: 'New name'
            }
        }]
    }
]
```

#### Обновление нескольких классов

```js
[
    {
        dbClass: 'house',
        items: [{
            id: selectedHouse.id,            
            content: {
                address: 'New adress',
                name: 'New name'
            }
        }]
    },
    {
        dbClass: 'street',
        items: selectedStreets.map(i => ({
            id: i.id,
            content: i.content
        }))
    }
]
```

#### Обновление с записью в историю

Обновление с записью в историю проходит в 3 этапа - скачать существующие данные, записать в историю, обновить данные. Обычно это не вызывает сильного замедления, т.к. эти запросы выполняются на сервере, но все же разница есть.

```js
[
    {
        dbClass: 'house',
        history: true,
        items: [{
            id: selectedHouse.id,            
            content: {
                address: 'New adress',
                name: 'New name'
            }
        }]
    }
]
```

## Конфигуратор

import Update from "../../src/wrappers/data/update"

<Update />

## История изменений

### v1.1.0 `2024.04.01`

:::warning #pre-release
:::

* Добавлена документация.
* `#breakingChange` Добавлена проверка максимального количества обновляемых документов.
* Добавлена запись истории изменений данных. Требуется обновить сервер.
* `#breakingChange` optimiticUpdate больше не срабатывает автоматически, если оффлайн.
* `#breakingChange` По завершению обновления все данные в порты выдаются одновременно, после срабатывает сигнал fetched.
